<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="description" content="">
<meta name="keywords" content="installation issues, mac osx">


<title>Installation Issues for Mac OSX | MTEX</title>

<link rel="stylesheet" href="css/syntax.css">

<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="css/modern-business.css">

<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<link rel="stylesheet" href="css/customstyles.css">
<link rel="stylesheet" href="css/boxshadowproperties.css">

<!-- most color styles are extracted out to here -->
<link rel="stylesheet" href="css/theme.css">
<link rel="stylesheet" href="css/theme-mtex.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="js/jquery.navgoco.min.js"></script>


<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- Anchor.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="js/toc.js"></script>
<script src="js/customscripts.js"></script>

<!-- Favicons -->
<link rel="apple-touch-icon" type="image/png" sizes="100x100" href="images/favicons/favicon.png">
<link rel="icon" type="image/png" sizes="100x100" href="images/favicons/favicon.png">
<link rel="manifest" href="images/favicons/manifest.json">
<meta name="msapplication-TileColor" content="#149983">
<meta name="msapplication-TileImage" size="100x100" type="image/png" content="images/favicons/favicon.png">
<meta name="theme-color" content="#149983">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="" href="http://localhost:4000/feed.xml">

<!-- enable MathJax
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
      tex2jax: {
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
          inlineMath: [['$','$']]
      }
  });
</script>-->
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>


    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    <script>
        $(document).ready(function() {
            $("#tg-sb-link").click(function() {
                $("#tg-sb-sidebar").toggle();
                $("#tg-sb-content").toggleClass('col-md-9');
                $("#tg-sb-content").toggleClass('col-md-12');
                $("#tg-sb-icon").toggleClass('fa-toggle-on');
                $("#tg-sb-icon").toggleClass('fa-toggle-off');
            });
        });
    </script>
    
</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-static-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-lg navbar-brand" href="index"><img src="images/icons/MTEX_100x67px.png"></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <br><br>
            <ul class="nav navbar-nav navbar-right">

                <!-- topnav -->
                
                
                    
                        
                        
                            <li><a href="index">Home</a></li>
                        
                    
                        
                        
                            <li><a href="download">Download</a></li>
                        
                    
                        
                        
                            <li><a href="Documentation">Documentation</a></li>
                        
                    
                        
                        
                            <li><a href="function_reference">Function Reference</a></li>
                        
                    
                        
                        
                            <li><a href="examples">Examples</a></li>
                        
                    
                        
                        
                            <li><a href="workshop24">Workshops</a></li>
                        
                    
                        
                        
                            <li><a href="people">People</a></li>
                        
                    
                        
                        
                            <li><a href="search"><i class="fa fa-search"></i></a></li>
                        
                    
                

                
            </ul>
        </div>
    </div>
    <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container">
  <div id="main">
    <!-- Content Row -->
    <div class="row">
        
        

        <!-- Content Column -->
        <div class="col-md-12" id="tg-sb-content">
            
    <div class="post-header">
        <h1 class="post-title-main">Installation Issues for Mac OSX</h1>
    </div>


<div class="post-content">

    

    


    

    <p>Since binaries are sometimes not compatible across different versions of
macOS and due to increasing security measures of Apple, some extra work might be
required to get MTEX running on macOS.</p>

<h2 id="library-load-disallowed-by-system-policy">library load disallowed by system policy</h2>

<p>If you experience the following error message</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Invalid MEX-file 'some path to
mtex/mtex-5.3/extern/nfft/nfsoftmex.mexmaci64': dlopen(some path to
mtex//mtex-5.3/extern/nfft/nfsoftmex.mexmaci64, 6): no suitable image
found.  Did find:
some path to mtex/mtex-5.3/extern/nfft/nfsoftmex.mexmaci64: code
signature in (some path to
mtex/mtex-5.3/extern/nfft/nfsoftmex.mexmaci64) not valid for use in
process using Library Validation: library load disallowed by system policy
</code></pre></div></div>

<p>you can either download MTEX with a command line tool such as
<a href="https://www.youtube.com/watch?v=6pyVl3GdSuU"><code class="language-plaintext highlighter-rouge">curl</code></a> or <code class="language-plaintext highlighter-rouge">wget</code></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-LJO</span> <span class="nt">--output</span> mtex.zip https://github.com/mtex-toolbox/mtex/releases/download/mtex-5.3/mtex-5.3.zip
</code></pre></div></div>
<p>or, if you have downloaded MTEX with a browser, type in Matlab</p>

<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">!</span><span class="nb">sudo </span>xattr <span class="nt">-r</span> <span class="nt">-d</span> com.apple.quarantine /path/to/mtexfolder
</code></pre></div></div>

<h2 id="unable-to-compile-mex-files-during-startup_mtex">Unable to compile mex files during startup_mtex</h2>

<p>If you (still) get the following error, you will need to recompile the mex files
on your own. MTEX tries to perform the compilation automatically. However, in
some case you might experience error messages like</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Error: unable to compile mex files during startup_mtex e.g.:

Checking mex files failed!
 &gt; Trying now to recompile mex files.
 &gt; In mex_install (line 15)
   In check_installation&gt;check_mex (line 69)
   In check_installation (line 33)
   In startup_mtex (line 66)
   In startup (line 7)
... compiling S1Grid_find.c
Building with 'Xcode with Clang'.
Compiling some path to mtex/mtex-5.3/mex/S1Grid_find.c failed!
</code></pre></div></div>
<p>or</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> &gt;   MTEX: Couldn't get the mex files working!
 &gt;   The original error message was:
 &gt;   Invalid MEX-file
 &gt; 'some path to mtex/mtex-5.3/mex/SO3Grid_dist_region.mexmaci64':
 &gt; dlopen(some path to mtex/mtex-5.3/mex/SO3Grid_dist_region.mexmaci64,
 &gt; 6): Library not loaded: @loader_path/libmex.dylib
 &gt;   Referenced from:
 &gt; some path to mtex/mtex-5.3/mex/SO3Grid_dist_region.mexmaci64
 &gt;   Reason: image not found
 &gt;   Contact author for help!
</code></pre></div></div>

<ol>
  <li>Make sure that after upgrading your system, to also upgrade <code class="language-plaintext highlighter-rouge">xcode</code>
 (via appstore) and install the command line tools and accept the licence by
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>xcodebuild <span class="nt">-license</span> accept
xcode-select <span class="nt">--install</span>
</code></pre></div>    </div>
  </li>
  <li>You might need to modify the compiler options used by Matlab. The configuration file can be found by the command
    <div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">m</span>  <span class="o">=</span> <span class="nb">mex</span><span class="o">.</span><span class="n">getCompilerConfigurations</span>
<span class="n">m</span><span class="o">.</span><span class="n">MexOpt</span>
<span class="nb">ans</span> <span class="o">=</span>
   <span class="p">/</span><span class="n">Users</span><span class="p">/</span><span class="n">rk</span><span class="p">/</span><span class="n">Library</span><span class="p">/</span><span class="n">Application</span><span class="p">/</span><span class="n">MathWorks</span><span class="p">/</span><span class="n">MATLAB</span><span class="p">/</span><span class="n">R2019b</span><span class="p">/</span><span class="n">mex_C_maci64</span><span class="o">.</span><span class="n">xml</span>
</code></pre></div>    </div>
    <p>The exact file name depends on the compiler installed on your system, e.g. <code class="language-plaintext highlighter-rouge">/Applications/MATLAB_R2019a.app/bin/maci64/mexopts/clang_maci64.xml</code>.
Within the configuration file change the lines</p>
  </li>
</ol>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="nt">&lt;SDKVER&gt;</span>
      <span class="nt">&lt;cmdReturns</span> <span class="na">name=</span><span class="s">"xcrun -sdk macosx --show-sdk-version"</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;/SDKVER&gt;</span>
</code></pre></div></div>

<p>to</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="nt">&lt;SDKVER&gt;</span>
      <span class="nt">&lt;cmdReturns</span> <span class="na">name=</span><span class="s">"xcrun -sdk macosx --show-sdk-version  | cut -c1-5"</span><span class="nt">/&gt;</span>
   <span class="nt">&lt;/SDKVER&gt;</span>
</code></pre></div></div>

<p>and do from within Matlab</p>
<div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mex</span> <span class="o">-</span><span class="nb">setup</span> <span class="n">C</span>
</code></pre></div></div>
<p>Now <code class="language-plaintext highlighter-rouge">startup_mtex.m</code> will hopefully run without any trouble.</p>

<h2 id="compiling-the-nfft">Compiling the nfft</h2>

<h3 id="1-install-gcc-with-openmp-and-libtools">1. Install gcc with openmp and libtools</h3>

<p>Using <a href="https://brew.sh/">homebrew</a> is probably the easiest</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew <span class="nb">install </span>gcc libtool
</code></pre></div></div>

<h3 id="2-get-nfft-source-from-github">2. Get nfft source from github</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/NFFT/nfft/
<span class="nb">cd  </span>nfft
./bootstrap.sh
</code></pre></div></div>

<h3 id="3-set-the-compilation-parameters">3. Set the compilation parameters</h3>

<p>The path to gcc and matlab depends on your system and should be set accordingly.
If you uesd homebrew to install gcc, it should have ended up in some place called
<code class="language-plaintext highlighter-rouge">Cellar</code> typically found in <code class="language-plaintext highlighter-rouge">/usr/local/</code>. Check the right version and replace them
accordingly in the lines below. The same of coure applies to the Mathlab path and
version. If you are one an architecture other than x86_64, also set this one correctly
(e.g. or leave the option out completely and hope that automatic recognition will work).
For the ARMv8 from Apple this is currectly untested.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">CC</span><span class="o">=</span>/usr/local/Cellar/gcc/8.2.0/bin/gcc-8
<span class="nv">LDFLAGS</span><span class="o">=</span><span class="nt">-Wl</span>,-L/usr/local/Cellar/gcc/8.2.0/lib/gcc/8
./configure <span class="nt">--with-matlab</span><span class="o">=</span>/Applications/MATLAB_R2018b.app <span class="nt">--enable-nfsoft</span><span class="se">\</span>
  <span class="nt">--enable-nfsft</span> <span class="nt">--enable-openmp</span> <span class="nt">--enable-portable-binary</span><span class="se">\</span>
  <span class="nt">--with-apple-gcc-arch</span><span class="o">=</span>x86_64 -
</code></pre></div></div>
<p>or if for some reason you can not use openMP</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">CC</span><span class="o">=</span>/usr/local/Cellar/gcc/8.2.0/bin/gcc-8
<span class="nv">LDFLAGS</span><span class="o">=</span><span class="nt">-Wl</span>,-L/usr/local/Cellar/gcc/8.2.0/lib/gcc/8
./configure <span class="nt">--with-matlab</span><span class="o">=</span>/Applications/MATLAB_R2018b.app <span class="nt">--enable-nfsoft</span><span class="se">\</span>
  <span class="nt">--enable-nfsft</span> <span class="nt">--enable-portable-binary</span> <span class="nt">--with-apple-gcc-arch</span><span class="o">=</span>x86_64
</code></pre></div></div>

<h3 id="4-compile-the-nfft">4. Compile the nfft</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make
</code></pre></div></div>

<h3 id="5-link-the-nfft">5. Link the nfft</h3>

<p>The easists way is to make out of the following lines an executable shell script.
Please do not forget to include the definitions of gcc and Matlab pathes from above.
Most likely you changed the exact version and path, so do this here accordingly.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="nv">CC</span><span class="o">=</span>/usr/local/Cellar/gcc/8.2.0/bin/gcc-8
<span class="nv">MATLABDIR</span><span class="o">=</span>/Applications/MATLAB_R2018b.app

<span class="k">for </span>LIB <span class="k">in </span>nfft nfsft nfsoft nnfft fastsum nfct nfst<span class="p">;</span> <span class="k">do
  </span><span class="nb">cd </span>matlab/<span class="s2">"</span><span class="nv">$LIB</span><span class="s2">"</span>
  <span class="s2">"</span><span class="nv">$CC</span><span class="s2">"</span> <span class="nt">-o</span> .libs/lib<span class="s2">"</span><span class="nv">$LIB</span><span class="s2">"</span>.mexmaci64 <span class="nt">-bundle</span> .libs/lib<span class="s2">"</span><span class="nv">$LIB</span><span class="s2">"</span>_la-<span class="s2">"</span><span class="nv">$LIB</span><span class="s2">"</span>mex.o <span class="se">\</span>
    <span class="nt">-Wl</span>,-force_load,../../.libs/libnfft3_matlab.a <span class="se">\</span>
    <span class="nt">-Wl</span>,-force_load,../../matlab/.libs/libmatlab.a <span class="se">\</span>
    <span class="nt">-L</span><span class="s2">"</span><span class="nv">$MATLABDIR</span><span class="s2">"</span>/bin/maci64 <span class="nt">-lm</span> <span class="nt">-lmwfftw3</span> <span class="nt">-lmx</span> <span class="nt">-lmex</span> <span class="se">\</span>
    <span class="nt">-lmat</span> <span class="nt">-fopenmp</span> <span class="nt">-O3</span> <span class="nt">-malign-double</span> <span class="nt">-march</span><span class="o">=</span>core2 <span class="se">\</span>
    <span class="nt">-arch</span> x86_64 <span class="nt">-fopenmp</span> <span class="nt">-static-libgcc</span>
  <span class="nb">cp</span> .libs/lib<span class="s2">"</span><span class="nv">$LIB</span><span class="s2">"</span>.mexmaci64 <span class="s2">"</span><span class="nv">$LIB</span><span class="s2">"</span>mex.mexmaci64
  <span class="nb">cd</span> ../..
<span class="k">done</span>
</code></pre></div></div>

<p>the vesion without <code class="language-plaintext highlighter-rouge">openMP</code></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="nv">CC</span><span class="o">=</span>/usr/local/Cellar/gcc/8.2.0/bin/gcc-8
<span class="nv">MATLABDIR</span><span class="o">=</span>/Applications/MATLAB_R2018b.app

<span class="k">for </span>LIB <span class="k">in </span>nfft nfsft nfsoft nnfft fastsum nfct nfst<span class="p">;</span> <span class="k">do
  </span><span class="nb">cd </span>matlab/<span class="s2">"</span><span class="nv">$LIB</span><span class="s2">"</span>
  <span class="s2">"</span><span class="nv">$CC</span><span class="s2">"</span> <span class="nt">-o</span> .libs/lib<span class="s2">"</span><span class="nv">$LIB</span><span class="s2">"</span>.mexmaci64 <span class="nt">-bundle</span> .libs/lib<span class="s2">"</span><span class="nv">$LIB</span><span class="s2">"</span>_la-<span class="s2">"</span><span class="nv">$LIB</span><span class="s2">"</span>mex.o <span class="se">\</span>
    <span class="nt">-Wl</span>,-force_load,../../.libs/libnfft3_matlab.a <span class="se">\</span>
    <span class="nt">-Wl</span>,-force_load,../../matlab/.libs/libmatlab.a <span class="se">\</span>
    <span class="nt">-L</span><span class="s2">"</span><span class="nv">$MATLABDIR</span><span class="s2">"</span>/bin/maci64 <span class="nt">-lm</span> <span class="nt">-lmwfftw3</span> <span class="nt">-lmx</span> <span class="nt">-lmex</span> <span class="se">\</span>
    <span class="nt">-lmat</span> <span class="nt">-O3</span> <span class="nt">-malign-double</span> <span class="nt">-march</span><span class="o">=</span>core2 <span class="se">\</span>
    <span class="nt">-arch</span> x86_64 <span class="nt">-static-libgcc</span>
  <span class="nb">cp</span> .libs/lib<span class="s2">"</span><span class="nv">$LIB</span><span class="s2">"</span>.mexmaci64 <span class="s2">"</span><span class="nv">$LIB</span><span class="s2">"</span>mex.mexmaci64
  <span class="nb">cd</span> ../..
<span class="k">done</span>
</code></pre></div></div>

<h3 id="6-copy-the-generated-mex-files-into-the-mtex-installation">6. Copy the generated mex-files into the MTEX installation</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make <span class="nb">install</span>
</code></pre></div></div>
<p>for mtex, copy the two files</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>matlab/nfsft/.libs/libnfsft.mexmaci64
matlab/nfsoft/.libs/libnfsoft.mexmaci64
</code></pre></div></div>
<p>into your mtex installation into</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mtex/extern/nfft_openMP/
</code></pre></div></div>
<p>or</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mtex/extern/nfft/
</code></pre></div></div>


    <div class="tags">
        
    </div>

    


</div>

<footer>
    <div class="row">
        <div class="col-lg-12 footer">
            <p>
                <img src="images/icons/MTEX_100x67px.png" alt="MTEX logo">
            </p>
        </div>
    </div>
</footer>

        </div>
    <!-- /.row -->
</div>
<!-- /.container -->
</div>
<!-- /#main -->
    </div>

</body>

<!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-83346204-1','auto');ga('require','displayfeatures');ga('send','pageview');</script>


</html>
