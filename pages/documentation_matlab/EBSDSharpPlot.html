---
title: Sharp Color Keys
last_updated: 11-Oct-2019
sidebar: documentation_sidebar
permalink: EBSDSharpPlot.html
folder: documentation
toc: false
---

<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Sharp Color Keys</title><meta name="generator" content="MATLAB 9.6"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2019-10-11"><meta name="DC.source" content="script_EBSDSharpPlot.m"></head><body><font size="2"><a href="#" data-toggle="tooltip" data-original-title="To edit this page type edit EBSDSharpPlot into the Matlab commandline">edit page</a></font><div><!--introduction--><!--/introduction--><p>In this section we discuss color keys that are particular useful when analyzing data with very small deviation in orientation. Let us consider the following calcite data set</p>
{% highlight matlab %}
% plotting conventions
plotx2east, plotb2east
mtexdata sharp

ebsd = ebsd('calcite');

ipfKey = ipfColorKey(ebsd);

close all;
plot(ebsd,ipfKey.orientation2color(ebsd.orientations))
{% endhighlight %}

{% highlight plaintext %}
 
ebsd = EBSD  
 
 Phase  Orientations     Mineral       Color  Symmetry  Crystal reference frame
     0    32 (0.16%)  notIndexed                                               
     1  20119 (100%)     calcite  light blue      -3m1       X||a*, Y||b, Z||c*
 
 Properties: x, y
 Scan unit : um
 

{% endhighlight %}

  {% include inline_image.html file="EBSDSharpPlot_01.png" %}
<p>and have a look into the 100 inverse pole figure.</p>
{% highlight matlab %}
% compute the positions in the inverse pole figure
h = ebsd.orientations .\ vector3d.X;
h = project2FundamentalRegion(h);

% compute the azimuth angle in degree
color = h.rho ./ degree;

plotIPDF(ebsd.orientations,vector3d.X,'property',color,'MarkerSize',3,'grid')
mtexColorbar
{% endhighlight %}

{% highlight plaintext %}
  I'm plotting 8333 random orientations out of 20119 given orientations

{% endhighlight %}

  {% include inline_image.html file="EBSDSharpPlot_02.png" %}
<p>We see that all individual orientations are clustered around azimuth angle 115 degrees with some outliers at 65 degree. In order to increase the contrast for the main group, we restrict the color range from 110 degree to 120 degree.</p>
{% highlight matlab %}
caxis([110 120]);

% by the following lines we colorcode the outliers in purple.
cmap = colormap;
cmap(end,:) = [1 0 1]; % make last color purple
cmap(1,:) = [1 0 1];   % make first color purple
colormap(cmap)
{% endhighlight %}

  {% include inline_image.html file="EBSDSharpPlot_03.png" %}
<p>The same colorcoding we can now apply to the EBSD map.</p>
{% highlight matlab %}
% plot the data with the customized color
plot(ebsd,color)

% set scaling of the angles to 110 - 120 degree
caxis([110 120]);

% colorize outliers in purple.
cmap = colormap;
cmap(end,:) = [1 0 1];
cmap(1,:) = [1 0 1];
colormap(cmap)
{% endhighlight %}

  {% include inline_image.html file="EBSDSharpPlot_04.png" %}
<h2 id="5">Sharpening the default colorcoding</h2><p>Next, we want to apply the same ideas as above to the default MTEX color key, i.e. we want to stretch the colors such that they cover just the orientations of interest.</p>
{% highlight matlab %}
ipfKey = ipfHSVKey(ebsd.CS.properGroup);

% To this end, we first compute the inverse pole figure direction such that
% the mean orientation is just at the gray spot of the inverse pole figure
ipfKey.inversePoleFigureDirection = mean(ebsd.orientations,'robust') * ipfKey.whiteCenter;

close all;
plot(ebsd,ipfKey.orientation2color(ebsd.orientations))
{% endhighlight %}

  {% include inline_image.html file="EBSDSharpPlot_05.png" %}
<p>We observe that the orientation map is almost completely gray, except for the  outliers which appears black. Next, we use the option <tt>maxAngle</tt> to increase contrast in the grayish part</p>
{% highlight matlab %}
ipfKey.maxAngle = 7.5*degree;
plot(ebsd,ipfKey.orientation2color(ebsd.orientations))
{% endhighlight %}

  {% include inline_image.html file="EBSDSharpPlot_06.png" %}
<p>You may play around with the option <tt>maxAngle</tt> to obtain better results. As for interpretation keep in mind that white color represents the mean orientation and the color becomes more saturated and later dark as the orientation to color diverges from the mean orientation.</p><p>Let's have a look at the corresponding color map.</p>
{% highlight matlab %}
plot(ipfKey,'resolution',0.25*degree)

% plot orientations into the color key
hold on
plotIPDF(ebsd.orientations,'points',10,'MarkerSize',1,'MarkerFaceColor','w','MarkerEdgeColor','w')
hold off
{% endhighlight %}

{% highlight plaintext %}
  I'm plotting 10 random orientations out of 20119 given orientations

{% endhighlight %}

  {% include inline_image.html file="EBSDSharpPlot_07.png" %}
<p>observe how in the inverse pole figure the orientations are scattered closely around the white center. Together with the fact that the transition from white to color is quite rapidly, this gives a high contrast.</p><h2 id="9">The axis angle color key</h2>
{% highlight matlab %}
[grains,ebsd.grainId] = calcGrains(ebsd,'angle',1.5*degree);
ebsd(grains(grains.grainSize&lt;=3)) = [];
[grains,ebsd.grainId] = calcGrains(ebsd,'angle',1.5*degree);

grains = smooth(grains,5);
{% endhighlight %}

{% highlight matlab %}
ipfKey = axisAngleColorKey(ebsd('indexed'));

% use for the reference orientation the grain mean orientation
ipfKey.oriRef = grains.meanOrientation(ebsd.grainId);

plot(ebsd,ipfKey.orientation2color(ebsd.orientations))

hold on
plot(grains.boundary,'lineWidth',4)
hold off
{% endhighlight %}

  {% include inline_image.html file="EBSDSharpPlot_08.png" %}

{% highlight matlab %}
F = halfQuadraticFilter;
F.alpha = 0.01;
F.eps = 1e-6;
F.tol = 1e-10;

ebsdS = smooth(ebsd,F);

% use for the reference orientation the grain mean orientation
ipfKey.oriRef = grains.meanOrientation(ebsdS('indexed').grainId);

plot(ebsdS('indexed'),ipfKey.orientation2color(ebsdS('indexed').orientations))

%hold on
%plot(grains.boundary,'lineWidth',4)
%hold off
{% endhighlight %}

  {% include inline_image.html file="EBSDSharpPlot_09.png" %}

{% highlight matlab %}
F = infimalConvolutionFilter;
F.lambda = 0.01;
F.mu = 0.02;

ebsdS = smooth(ebsd,F);

[grains,ebsdS.grainId] = calcGrains(ebsdS,'angle',1*degree);
%ebsdS(grains(grains.grainSize&lt;=3)) = [];
%[grains,ebsdS.grainId] = calcGrains(ebsdS,'angle',1.5*degree);

grains = smooth(grains,5);


% use for the reference orientation the grain mean orientation
ipfKey.oriRef = grains(ebsdS('indexed').grainId).meanOrientation;
%ipfKey.oriRef = mean(ebsdS('indexed').orientations);

plot(ebsdS('indexed'),ipfKey.orientation2color(ebsdS('indexed').orientations),'micronbar','off')

hold on
plot(grains.boundary,'lineWidth',4)
hold off
{% endhighlight %}

  {% include inline_image.html file="EBSDSharpPlot_10.png" %}
<p>Another example is when analyzing the orientation distribution within grains</p>
{% highlight matlab %}
mtexdata forsterite
ebsd = ebsd('indexed');

% segment grains
[grains,ebsd.grainId] = calcGrains(ebsd);

% find largest grains
largeGrains = grains(grains.grainSize &gt; 800)

ebsd = ebsd(largeGrains(1))
{% endhighlight %}

{% highlight plaintext %}
 
ebsd = EBSD  
 
 Phase  Orientations     Mineral         Color  Symmetry  Crystal reference frame
     0   58485 (24%)  notIndexed                                                 
     1  152345 (62%)  Forsterite  LightSkyBlue       mmm                         
     2   26058 (11%)   Enstatite  DarkSeaGreen       mmm                         
     3   9064 (3.7%)    Diopside     Goldenrod     12/m1       X||a*, Y||b*, Z||c
 
 Properties: bands, bc, bs, error, mad, x, y
 Scan unit : um
 
 
largeGrains = grain2d  
 
 Phase  Grains  Pixels     Mineral  Symmetry  Crystal reference frame
     1      56   85514  Forsterite       mmm                         
     2       2    1969   Enstatite       mmm                         
 
 boundary segments: 17507
 triple points: 1247
 
 Properties: GOS, meanRotation
 
 
ebsd = EBSD  
 
 Phase  Orientations     Mineral         Color  Symmetry  Crystal reference frame
     1   1453 (100%)  Forsterite  LightSkyBlue       mmm                         
 
 Properties: bands, bc, bs, error, mad, x, y, grainId
 Scan unit : um
 

{% endhighlight %}
<p>When plotting one specific grain with its orientations we see that they all are very similar and, hence, get the same color</p>
{% highlight matlab %}
% plot a grain
close all
plot(largeGrains(1).boundary,'linewidth',2)
hold on
plot(ebsd,ebsd.orientations)
hold off
{% endhighlight %}

  {% include inline_image.html file="EBSDSharpPlot_11.png" %}
<p>when applying the option sharp MTEX colors the mean orientation as white and scales the maximum saturation to fit the maximum misorientation angle. This way deviations of the orientation within one grain can be visualized.</p>
{% highlight matlab %}
% plot a grain
plot(largeGrains(1).boundary,'linewidth',2)
hold on
ipfKey = ipfHSVKey(ebsd);
ipfKey.inversePoleFigureDirection = mean(ebsd.orientations) * ipfKey.whiteCenter;
ipfKey.maxAngle = 2*degree;
plot(ebsd,ipfKey.orientation2color(ebsd.orientations))
hold off
{% endhighlight %}

  {% include inline_image.html file="EBSDSharpPlot_12.png" %}
</div></body></html>