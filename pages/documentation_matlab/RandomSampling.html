---
title: Random Sampling
last_updated: 08-Oct-2019
sidebar: documentation_sidebar
permalink: RandomSampling.html
folder: documentation
toc: false
---

<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Random Sampling</title><meta name="generator" content="MATLAB 9.7"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2019-10-08"><meta name="DC.source" content="script_RandomSampling.m"></head><body><font size="2"><a href="#" data-toggle="tooltip" data-original-title="To edit this page type edit RandomSampling into the Matlab commandline">edit page</a></font><div><!--introduction--><!--/introduction--><p>MTEX allows one to simulate an arbitrary number of EBSD data from any ODF. This is quite helpful if you want to analyze the EBSD to ODF estimation routine.</p><p><b>Define a Model ODF</b></p><p>Let us first define a simple fibre symmetric ODF.</p>
  {% highlight matlab %}
  cs = crystalSymmetry(<span class="string">'32'</span>);
fibre_odf = 0.5*uniformODF(cs) + 0.5*fibreODF(Miller(0,0,0,1,cs),zvector);
  {% endhighlight %}

  {% highlight matlab %}
  plot(fibre_odf,<span class="string">'sections'</span>,6,<span class="string">'silent'</span>)
  {% endhighlight %}

  {% include inline_image.html file="RandomSampling_01.png" %}
<h2 id="4">Simulate EBSD Data</h2><p>This ODF we use now to simulate 10000 individual orientations.</p>
  {% highlight matlab %}
  ori = calcOrientations(fibre_odf,10000)
  {% endhighlight %}

        {% highlight matlab %}
         
ori = orientation  
  size: 10000 x 1
  crystal symmetry : 321, X||a*, Y||b, Z||c*
  specimen symmetry: 1
 

        {% endhighlight %}
    <h2 id="5">ODF Estimation from EBSD Data</h2><p>From the 10000 individual orientations, we can now estimate an ODF. First, we determine the optimal kernel function</p>
  {% highlight matlab %}
  psi = calcKernel(ori)
  {% endhighlight %}

        {% highlight matlab %}
         estimate optimal kernel halfwidth: 100%
 
psi = deLaValleePoussinKernel  
  bandwidth: 43
  halfwidth: 5.7&deg;
 

        {% endhighlight %}
    <p>and then we use this kernel function for kernel density estimation</p>
  {% highlight matlab %}
  odf = calcODF(ori,<span class="string">'kernel'</span>,psi)
  {% endhighlight %}

        {% highlight matlab %}
         
odf = ODF  
  crystal symmetry : 321, X||a*, Y||b, Z||c*
  specimen symmetry: 1
 
  Harmonic portion:
    degree: 43
    weight: 1
 

        {% endhighlight %}
    <p>which can be plotted,</p>
  {% highlight matlab %}
  plot(odf,<span class="string">'sections'</span>,6,<span class="string">'silent'</span>)
  {% endhighlight %}

  {% include inline_image.html file="RandomSampling_02.png" %}
<p>and compared to the original model ODF.</p>
  {% highlight matlab %}
  calcError(odf,fibre_odf,<span class="string">'resolution'</span>,5*degree)
  {% endhighlight %}

        {% highlight matlab %}
        ans =
    0.0975

        {% endhighlight %}
    <h2 id="9">Exploration of the relationship between estimation error and number of single orientations</h2><p>For a more systematic analysis of the estimation error, we simulate 10, 100, ..., 1000000 single orientations of the model ODF and calculate the approximation error for the ODFs estimated from these data.</p>
  {% highlight matlab %}
  e = [];
<span class="keyword">for</span> i = 1:6

  ori = calcOrientations(fibre_odf,10^i,<span class="string">'silent'</span>);

  psi1 = calcKernel(ori,<span class="string">'SamplingSize'</span>,10000,<span class="string">'silent'</span>);
  odf = calcODF(ori,<span class="string">'kernel'</span>,psi1,<span class="string">'silent'</span>);
  e(i,1) = calcError(odf,fibre_odf,<span class="string">'resolution'</span>,2.5*degree);

  psi2 = calcKernel(ori,<span class="string">'method'</span>,<span class="string">'RuleOfThumb'</span>,<span class="string">'silent'</span>);
  odf = calcODF(ori,<span class="string">'kernel'</span>,psi2,<span class="string">'silent'</span>);
  e(i,2) = calcError(odf,fibre_odf,<span class="string">'resolution'</span>,2.5*degree);

  psi3 = calcKernel(ori,<span class="string">'method'</span>,<span class="string">'magicRule'</span>,<span class="string">'silent'</span>);
  odf = calcODF(ori,<span class="string">'kernel'</span>,psi3,<span class="string">'silent'</span>);
  e(i,3) = calcError(odf,fibre_odf,<span class="string">'resolution'</span>,2.5*degree);

  disp([<span class="string">'RuleOfThumb: '</span> int2str(psi2.halfwidth/degree) mtexdegchar <span class="keyword">...</span>
    <span class="string">' KLCV: '</span> int2str(psi1.halfwidth/degree) mtexdegchar <span class="keyword">...</span>
    <span class="string">' magicRule: '</span> int2str(psi3.halfwidth/degree) mtexdegchar <span class="keyword">...</span>
    ]);

<span class="keyword">end</span>
  {% endhighlight %}

        {% highlight matlab %}
        progress: 100%
progress: 75%
progress: 75%
RuleOfThumb: 90&deg; KLCV: 24&deg; magicRule: 31&deg;
progress: 100%
progress: 81%
progress: 95%
RuleOfThumb: 42&deg; KLCV: 15&deg; magicRule: 22&deg;
RuleOfThumb: 18&deg; KLCV: 9&deg; magicRule: 16&deg;
RuleOfThumb: 10&deg; KLCV: 6&deg; magicRule: 11&deg;
RuleOfThumb: 9&deg; KLCV: 5&deg; magicRule: 8&deg;
RuleOfThumb: 7&deg; KLCV: 4&deg; magicRule: 6&deg;

        {% endhighlight %}
    <p>Plot the error in dependency of the number of single orientations.</p>
  {% highlight matlab %}
  close <span class="string">all</span>;
loglog(10.^(1:length(e)),e)
legend(<span class="string">'Default'</span>,<span class="string">'RuleOfThumb'</span>,<span class="string">'magicRule'</span>)
xlabel(<span class="string">'Number of orientations'</span>)
ylabel(<span class="string">'Estimation Error'</span>)
title(<span class="string">'Error between original fibre ODF model and simulated ebsd'</span>,<span class="string">'FontWeight'</span>,<span class="string">'bold'</span>)
  {% endhighlight %}

  {% include inline_image.html file="RandomSampling_03.png" %}
</div></body></html>