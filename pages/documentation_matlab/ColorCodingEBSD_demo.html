---
title: EBSD Color Coding
last_updated: 11-Oct-2019
sidebar: documentation_sidebar
permalink: ColorCodingEBSD_demo.html
folder: documentation
toc: false
---

<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>EBSD Color Coding</title><meta name="generator" content="MATLAB 9.6"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2019-10-11"><meta name="DC.source" content="script_ColorCodingEBSD_demo.m"></head><body><font size="2"><a href="#" data-toggle="tooltip" data-original-title="To edit this page type edit ColorCodingEBSD_demo into the Matlab commandline">edit page</a></font><div><!--introduction--><p>Explains EBSD color coding.</p><!--/introduction--><h2 id="2">Contents</h2><h2 id="3">See also</h2><p>EBSD/plotspatial grain/plotGrains ebsdColorbar orientation2color</p><h2 id="4">Colorcoding of orientations</h2><p>In order to visualize orientation maps as they are measured by EBSD one has to assign a color to each possible orientation. As an example, one may think of representing an orientation by its Euler angles ph1, Phi, phi2 and taking these as the RGB values of a color. Of course, there are many other ways to do this. Before presenting all the possibilities MTEX offers to assign a color to each orientation let us shortly summarize what properties we expect from such an assignment.</p><div><ol><li>crystallographic equivalent orientations should have the same color</li><li>similar orientations should have similar colors</li><li>different orientations should have different colors</li><li>the whole colorspace should be used for full contrast</li><li>if the orientations are concentrated in a small region of the orientation space, the colorspace should be exhaust by this region</li></ol></div><p>It should be noted that it is impossible to have all the 4 points mentioned above represented by a single colorcoding. This is mainly due the fact that the orientation space is three dimensional and the colorspace is only two dimensional, i.e., there are too few colors to cover the whole orientation space in an unambiguous way. Hence, some compromises have to be accepted and some assumptions have to be made.</p><h2 id="5">Assigning the Euler angles to the RGB values</h2><p>Using the Euler angles as the RGB values is probably the simplest way of mapping an orientation to a color. In MTEX such a color key is defined as a variable of type <a href="orientationColorKey.html">orientatiomColorKey</a></p>
{% highlight matlab %}
% we have to set up a crystal symmetry first, as it defines the fundamental
% region for the Euler angles
cs = crystalSymmetry('432')

% thise defins the orientation map
oM = BungeColorKey(cs)
{% endhighlight %}

{% highlight plaintext %}
 
cs = crystalSymmetry  
 
  symmetry: 432    
  a, b, c : 1, 1, 1
 
oM = 
  BungeColorKey with properties:

       center: [1&times;1 quaternion]
    phi1Range: [0 6.2832]
    phi2Range: [0 1.5708]
     PhiRange: [0 1.5708]
          CS1: [6&times;4 crystalSymmetry]
          CS2: [1&times;1 specimenSymmetry]
    antipodal: 0

{% endhighlight %}
<p>Given an arbitrary orientation</p>
{% highlight matlab %}
ori = orientation.byEuler(10*degree,20*degree,0*degree)
{% endhighlight %}

{% highlight plaintext %}
 
ori = orientation  
  size: 1 x 1
  crystal symmetry : 1, X||a, Y||b*, Z||c*
  specimen symmetry: 1
 
  Bunge Euler angles in degree
  phi1  Phi phi2 Inv.
    10   20    0    0
 

{% endhighlight %}
<p>we can compute the corresponding color as rgb values by</p>
{% highlight matlab %}
rgb = oM.orientation2color(ori)
{% endhighlight %}

{% highlight plaintext %}
rgb =
    0.0278    0.2222         0

{% endhighlight %}
<p>Lets visualize the orientation map by plotting it in orientation space as phi_2 sections</p>
{% highlight matlab %}
plot(oM,'sections',6,'phi2')
{% endhighlight %}

  {% include inline_image.html file="ColorCodingEBSD_demo_01.png" %}
<p>Although this visualization looks very smooth, the orientation map using Euler angles introduces lots of color jumps, i.e., the point 2 of our requirement list is not satisfied. This becomes obvious when plotting the colors as sigma sections, i.e., when section according to phi_1 - phi_2</p>
{% highlight matlab %}
plot(oM,'sections',6,'sigma')
{% endhighlight %}

  {% include inline_image.html file="ColorCodingEBSD_demo_02.png" %}
<h2 id="10">Colorcoding according to inverse pole figure</h2><p>The standard way of mapping orientations to colors is based on inverse pole figures. The following orientation map assigns a color to each direction of the fundamental sector of the inverse pole figure</p>
{% highlight matlab %}
oM = ipfHSVKey(cs)

plot(oM)
{% endhighlight %}

{% highlight plaintext %}
oM = 
  ipfHSVKey with properties:

             colorPostRotation: [1&times;1 rotation]
               colorStretching: 1
                   whiteCenter: [1&times;1 vector3d]
                     grayValue: [0.2000 0.5000]
                  grayGradient: 0.5000
                      maxAngle: Inf
    inversePoleFigureDirection: [1&times;1 vector3d]
                        dirMap: [1&times;1 HSVDirectionKey]
                           CS1: [6&times;4 crystalSymmetry]
                           CS2: [1&times;1 specimenSymmetry]
                     antipodal: 0

{% endhighlight %}

  {% include inline_image.html file="ColorCodingEBSD_demo_03.png" %}
<p>We may also look at the inverse pole figure sphere in 3d. One can nicely observe how the color map follows the given symmetry group.</p>
{% highlight matlab %}
close all
plot(oM,'3d')
{% endhighlight %}

  {% include inline_image.html file="ColorCodingEBSD_demo_04.png" %}
<p>Alternatively, we may plot the color mapping in 2d on the entire sphere together with the symmetry elements</p>
{% highlight matlab %}
plot(oM,'complete')

hold on
plot(cs)
hold off
{% endhighlight %}

  {% include inline_image.html file="ColorCodingEBSD_demo_05.png" %}
<p>The orientation map provides several options to alter the alignment of the colors. Lets give some examples</p>
{% highlight matlab %}
% we may interchange green and blue by setting
oM.colorPostRotation = reflection(yvector);

plot(oM)
{% endhighlight %}

  {% include inline_image.html file="ColorCodingEBSD_demo_06.png" %}
<p>or shift the cycle of colors red, green, blue by</p>
{% highlight matlab %}
oM.colorPostRotation = rotation.byAxisAngle(zvector,120*degree);

plot(oM)
{% endhighlight %}

  {% include inline_image.html file="ColorCodingEBSD_demo_07.png" %}
<p>Lets now consider an EBSD map</p>
{% highlight matlab %}
mtexdata forsterite

plot(ebsd)
{% endhighlight %}

{% highlight plaintext %}
 
ebsd = EBSD  
 
 Phase  Orientations     Mineral         Color  Symmetry  Crystal reference frame
     0   58485 (24%)  notIndexed                                                 
     1  152345 (62%)  Forsterite  LightSkyBlue       mmm                         
     2   26058 (11%)   Enstatite  DarkSeaGreen       mmm                         
     3   9064 (3.7%)    Diopside     Goldenrod     12/m1       X||a*, Y||b*, Z||c
 
 Properties: bands, bc, bs, error, mad, x, y
 Scan unit : um
 

{% endhighlight %}

  {% include inline_image.html file="ColorCodingEBSD_demo_08.png" %}
<p>and assume we want to colorize the Forsterite phase according to its orientation. Then we first define the orientation mapping. Note that we can pass the phase we want to color instead of the crysta symmetry</p>
{% highlight matlab %}
oM = ipfHSVKey(ebsd('Forsterite'))
{% endhighlight %}

{% highlight plaintext %}
oM = 
  ipfHSVKey with properties:

             colorPostRotation: [1&times;1 rotation]
               colorStretching: 1
                   whiteCenter: [1&times;1 vector3d]
                     grayValue: [0.2000 0.5000]
                  grayGradient: 0.5000
                      maxAngle: Inf
    inversePoleFigureDirection: [1&times;1 vector3d]
                        dirMap: [1&times;1 HSVDirectionKey]
                           CS1: [4&times;2 crystalSymmetry]
                           CS2: [1&times;1 specimenSymmetry]
                     antipodal: 0

{% endhighlight %}
<p>We may also want to set the inverse pole figure direction. This is done by</p>
{% highlight matlab %}
oM.inversePoleFigureDirection = zvector;
{% endhighlight %}
<p>Next we compute the color corresponding to each orientation we want to plot.</p>
{% highlight matlab %}
color = oM.orientation2color(ebsd('Forsterite').orientations);
{% endhighlight %}
<p>Finally, we can use these colors to visualize the orientations of the Forsterite phase</p>
{% highlight matlab %}
plot(ebsd('Forsterite'),color)
{% endhighlight %}

  {% include inline_image.html file="ColorCodingEBSD_demo_09.png" %}
<p>We can visualize the orientations of the forsterite phase also the other way round by plotting them into the inverse pole figure map.</p>
{% highlight matlab %}
plot(oM)

hold on
plotIPDF(ebsd('Forsterite').orientations,oM.inversePoleFigureDirection,...
  'MarkerSize',4,'MarkerFaceColor','none','MarkerEdgeColor','k')
hold off
{% endhighlight %}

{% highlight plaintext %}
  I'm plotting 12500 random orientations out of 152345 given orientations

{% endhighlight %}

  {% include inline_image.html file="ColorCodingEBSD_demo_10.png" %}
<p>Since orientations measured by EBSD devices are pure rotations specified by its Euler angles, we may restrict the crystal symmetry group to pure rotations as well. As this group is smaller, in general, the corresponding fundamental sector is larger, which allows distinguishing more rotations</p>
{% highlight matlab %}
% this restricts the crystal symmetries used for visualization
% to proper rotations
ebsd('Forsterite').CS = ebsd('Forsterite').CS.properGroup;
oM = ipfHSVKey(ebsd('Forsterite'))

%
plot(oM)
{% endhighlight %}

{% highlight plaintext %}
oM = 
  ipfHSVKey with properties:

             colorPostRotation: [1&times;1 rotation]
               colorStretching: 1
                   whiteCenter: [1&times;1 vector3d]
                     grayValue: [0.2000 0.5000]
                  grayGradient: 0.5000
                      maxAngle: Inf
    inversePoleFigureDirection: [1&times;1 vector3d]
                        dirMap: [1&times;1 HSVDirectionKey]
                           CS1: [4&times;1 crystalSymmetry]
                           CS2: [1&times;1 specimenSymmetry]
                     antipodal: 0

{% endhighlight %}

  {% include inline_image.html file="ColorCodingEBSD_demo_11.png" %}
<p>We observe that the fundamental sector is twice as large as for the original crystal symmetry. Furthermore, the measured Euler angles are not symmetric within this enlarged fundamental sector</p>
{% highlight matlab %}
hold on
plotIPDF(ebsd('Forsterite').orientations,oM.inversePoleFigureDirection,...
  'MarkerSize',4,'MarkerFaceColor','none','MarkerEdgeColor','k')
hold off
{% endhighlight %}

{% highlight plaintext %}
  I'm plotting 25000 random orientations out of 152345 given orientations

{% endhighlight %}

  {% include inline_image.html file="ColorCodingEBSD_demo_12.png" %}
<p>Lets finish this example by plotting the ebsd map of the Forsterite orientations color mapped according to this restricted symmetry group. The advantage of restricting the symmetry group is that we can distinguish more grains.</p>
{% highlight matlab %}
color = oM.orientation2color(ebsd('Forsterite').orientations);

plot(ebsd('Forsterite'),color)
{% endhighlight %}

  {% include inline_image.html file="ColorCodingEBSD_demo_13.png" %}
</div></body></html>