---
title: Density Estimation
last_updated: 08-Nov-2019
sidebar: documentation_sidebar
permalink: DensityEstimation.html
folder: documentation
toc: false
---
    <html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Density Estimation</title><meta name="generator" content="MATLAB 9.6"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2019-11-08"><meta name="DC.source" content="script_DensityEstimation.m"></head><body><font size="2"><a href="https://github.com/mtex-toolbox/mtex/blob/develop/doc/GeneralConcepts/DensityEstimation.m">
    edit page</a></font><div><!--introduction--><!--/introduction--><p>Density estimation is a concept to estimate a probability density function \(f_N\) from given random samples \(x_n\), \(n=1,\ldots,N\). In the simplest case the random samples \(x_n\) are real numbers and come from a unknown distribution function \(f\) and the goal is that \(f_N\) approximates \(f\) as best as possible.</p><p>Lets illustrate this setting at a the example of a mixed Gaussian distribution</p>
{% highlight matlab %}
% the true density function
f = @(x) Gaussian(0.2,0.05,x) + Gaussian(0.5,0.2,x);

% plot the true density function
x = linspace(0,1,1000);
plot(x,f(x),'linewidth',2)

% a random sample
N = 20;
xN = discreteSample(f,N,'range',[0,1]);

% plot the random sample
hold on
plot(xN,zeros(size(xN)),'o','LineWidth',2,'MarkerEdgeColor','r')
hold off
{% endhighlight %}
<center>
{% include inline_image.html file="DensityEstimation_01.png" %}
</center><h2 id="2">The Histogramm</h2><p>The easiest way to estimate a density function from the samples \(x_n\) is compute a histgram</p>
{% highlight matlab %}
histogram(xN,10)
hold on
plot(x,f(x),'linewidth',2)
plot(xN,zeros(size(xN)),'o','LineWidth',2,'MarkerEdgeColor','r')
hold off
{% endhighlight %}
<center>
{% include inline_image.html file="DensityEstimation_02.png" %}
</center><p>However, since the histogram allways leads to a picewice constant function the fit to the true density function \(f\) is usually not so good. A better alternative is kernel density estimation.</p><h2 id="4">Kernel Density Estimation</h2><p>The idea of kernel density estimation is to fix some kernel function \(\psi\), e.g. a Gaussian,</p>
{% highlight matlab %}
psi = Gaussian(0,0.05);
{% endhighlight %}
<p>shift its center to the position of each sample points \(x_n\)</p>
{% highlight matlab %}
plot(xN,zeros(size(xN)),'o','LineWidth',2,'MarkerEdgeColor','r')
hold on
for n = 1:N, plot(x,psi(x-xN(n)),'k'); end
hold off
{% endhighlight %}
<center>
{% include inline_image.html file="DensityEstimation_03.png" %}
</center><p>and take the mean</p><p>\[ f(x) = \frac{1}{N} \sum_{n=1}^N \psi(x-x_n) \]</p><p>of all the these shifted kernel functions</p>
{% highlight matlab %}
fN = @(x) mean(psi(x-xN),1);

hold on
plot(x,fN(x),'linewidth',2)
plot(x,f(x),'linewidth',2)
hold off
{% endhighlight %}
<center>
{% include inline_image.html file="DensityEstimation_04.png" %}
</center><p>We observe that this gives a much better approximation to true density function \(f\). The most important parameter when computing the kernel density estimate of a random sample is the halfwidth or standard deviation of the corresponding kernel function. Lets repeat the above density estimation with three different standard deviations</p>
{% highlight matlab %}
% plot the true density function
plot(x,f(x),'linewidth',2)
hold on

% and on top the kernel density estimates with different halfwidth
delta = [0.01 0.05 0.25];
for d = delta

  psi = Gaussian(0,d);
  fN = @(x) mean(psi(x-xN),1);
  plot(x,fN(x),'linewidth',2)

end
hold off
legend('\(f\)','\(f_{0.01}\)','\(f_{0.05}\)','\(f_{0.25}\)','interpreter','Latex'),
{% endhighlight %}
<center>
{% include inline_image.html file="DensityEstimation_05.png" %}
</center><p>In general a too small halfwidth leads to heavily oscillating functions, while a to large halfwdith will result in too smooth functions. In the case of one dimensional data the optimal half width is determined automatically when using the command <a href="calcDensity.html"><code class="language-plaintext highlighter-rouge">calcDensity</code></a>.</p>
{% highlight matlab %}
fN = calcDensity(xN,'range',[0;1]);

plot(x,f(x),'linewidth',2)
hold on
plot(x,fN(x),'linewidth',2)
hold off
{% endhighlight %}
<center>
{% include inline_image.html file="DensityEstimation_06.png" %}
</center><h2 id="9">Kernel Density Estimation in d-Dimensions</h2><p>The command <a href="calcDensity.html">calcDensity</a> may also be applied to \(d\)-dimenional data. For simplicity lets consider a two dimensional example where both \(x\) and \(y\) coordinates are distributed according to the distribution \(f\) defined at the very beginning of this section.</p>
{% highlight matlab %}
% the number of sample points
N = 100;
xN = discreteSample(f,N);
yN = discreteSample(f,N);

% plot the random sample
scatter(xN,yN)
{% endhighlight %}
<center>
{% include inline_image.html file="DensityEstimation_07.png" %}
</center><p>Similarly to the one dimensional example we need to specify the range of the \(x\) and \(y\) coordinates for the estimated density function. The format is <code class="language-plaintext highlighter-rouge">[xMin yMin; xMax yMax]</code>.</p>
{% highlight matlab %}
% compte the two dimensional density function
fN = calcDensity([xN,yN],'range',[0 0;1 1])

% plot the two dimensional density function
[x,y] = ndgrid(linspace(0,1));
pcolor(x,y,fN(x,y))
shading interp

% plot the original random sample on top
hold on
scatter(xN,yN,'.','k')
hold off
{% endhighlight %}

{% highlight plaintext %}
fN = 
  griddedInterpolant with properties:

            GridVectors: {[1&times;1000 double]  [1&times;1000 double]}
                 Values: [1000&times;1000 double]
                 Method: 'spline'
    ExtrapolationMethod: 'spline''
{% endhighlight %}
<center>
{% include inline_image.html file="DensityEstimation_08.png" %}
</center><h2 id="11">Density Estimation on the Sphere</h2><h2 id="12">Density Estimation in Orientation Space</h2></div></body></html>